@using Microsoft.AspNetCore.Components.Forms
@using System.Linq.Expressions;
@using System.Reflection;
@using Boozor.Shared;
@inherits Field<TModel, Relation<TItem>>
@typeparam TModel
@typeparam TItem where TItem : IEntity

@* Enums, Data Relation, *@

@{
    base.BuildRenderTree(__builder);
}

@code {

    [Parameter] public IEnumerable<TItem> Items { get; set; }
    [Parameter] public Expression<Func<TItem, object>> DisplayFor { get; set; }
    private PropertyInfo displayPropertyInfo;

    protected override void OnParametersSet()
    {
        displayPropertyInfo = DisplayFor.GetPropertyInfo();
        base.OnParametersSet();
    }

    protected override RenderFragment ChildContent => __builder =>
    {
        <div class="col-md-@Columns col-sm-12">
            <label class="form-label">
                @Label
            </label>
            <InputSelect TValue="Relation<TItem>" Value="@Value" ValueChanged="SetRelation" ValueExpression="GetValueExpression()"
                readonly=@ReadOnly class="form-control">

                @foreach (var item in Items)
                {
                    <option value="@item.Id">@displayPropertyInfo.GetValue(item)</option>
                }
            </InputSelect>
        </div>
    };

    private Relation<TItem> SetRelation(string item)
    {
        return new Relation<TItem>(item);
    }
}
