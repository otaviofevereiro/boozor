@page "/person"

@inject HttpClient Http

<View Model="@_person" TEntity=Person Title="Person" Columns=6>
    <TextField @bind-Value="_person.Id" readonly Columns=4 />
    <TextField @bind-Value="_person.Name" Columns=8 />
    <TextField @bind-Value="_person.Email" />
    <DateField @bind-Value="_person.BirthDate" Columns=6 />
</View>

<DataTable TModel=Person @bind-Items=_persons OnSelectItem="OnSelectItem" Multiselect=false Delete=true>
    <ChildContent>
        <Column TModel=Person Value="(p => p.Id)" />
        <Column TModel=Person Value="(p => p.Name)" />
        <Column TModel=Person Value="(p => p.BirthDate)" />
        <Column TModel=Person Value="(p => p.Email)" />
    </ChildContent>

    <Toolbar>
        <ColumnButton Text="Custom" Color="danger" TModel=Person OnClick="CustomSelect" />
        <ColumnButton Text="Custom2" TModel=Person OnClick="CustomSelect" />
    </Toolbar>
</DataTable>

@code {

    Person _person = new()
    {
        Name = "otavio",
        Email = "a@a.com.br",
        BirthDate = new DateTime(1990, 12, 26)
    };

    List<Person> _persons = new()
    {
        new()
        {
            Id = "1",
            Name = "Otavio",
            BirthDate = new DateTime(1990, 12, 26),
            Email = "otavio@otavio.com.br"
        },
        new()
        {
            Id = "2",
            Name = "Carol",
            BirthDate = new DateTime(1990, 05, 11),
            Email = "otavio@otavio.com.br"
        }
    };

    public async Task OnValidSubmit()
    {
        _person.Name = "otavio";

        HttpRequestMessage request = new()
        {
            Method = HttpMethod.Post,
            Content = JsonContent.Create(_person)
        };

        request.Headers.Add("type", typeof(Person).FullName);

        var result = await Http.SendAsync(request);
    }

    public Task OnDelete()
    {
        return Task.Delay(1000);
    }

    public void OnSelectItem(Person person)
    {
        _person = person;
    }

    public void CustomSelect(Person person)
    {
        _person = person;
    }
}
